/**
 * Minified by jsDelivr using Terser v5.37.0.
 * Original file: /npm/jzz-gui-player@1.7.6/javascript/JZZ.gui.Player.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?(i.Player=i,module.exports=i):"function"==typeof define&&define.amd?define("JZZ.gui.Player",["JZZ","JZZ.midi.SMF"],i):i(JZZ)}(0,(function(t){if(t.gui||(t.gui={}),!t.gui.Player){var i={on:s,off:s,disable:s,title:s,div:{}},e={container:{backgroundColor:"#888",borderRadius:"0px",borderWidth:"1px"},lbl:{color:"#aaa",fontSize:"12px",fontFamily:"Arial, Helvetica, sans-serif"},btn:{borderRadius:"0px",backgroundColor:{on:"#ddd",off:"#aaa",disable:"#888"},borderColor:{on:"#ccc",off:"#ccc",disable:"#aaa"},svgFill:{on:"#000",off:"#000",disable:"#555"},close:{borderRadius:"0px",backgroundColor:"#f44"}},rail:{borderRadius:"2px",borderWidth:"1px",backgroundColor:{enable:"#ccc",disable:"#888"},borderColor:{enable:"#ccc",disable:"#aaa"}},caret:{borderRadius:"6px",borderWidth:"1px",backgroundColor:{mouseDown:"#ddd",mouseUp:"#aaa",enable:"#aaa",disable:"#888"},borderColor:{enable:"#ccc",disable:"#aaa"}},svg:{play:'<svg fill="#555" height="18" viewBox="0 0 24 24" width="18" xmlns="http://www.w3.org/2000/svg"><path d="M8 5v14l11-7z"/><path d="M0 0h24v24H0z" fill="none"/></svg>',pause:'<svg fill="#555" height="18" viewBox="0 0 24 24" width="18" xmlns="http://www.w3.org/2000/svg"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/><path d="M0 0h24v24H0z" fill="none"/></svg>',stop:'<svg fill="#555" height="18" viewBox="0 0 24 24" width="18" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M6 6h12v12H6z"/></svg>',loop:'<svg fill="#555" height="18" viewBox="0 0 24 24" width="18" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8z"/></svg>',more:'<svg fill="#555" height="18" viewBox="0 0 24 24" width="18" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M12 3v9.28c-.47-.17-.97-.28-1.5-.28C8.01 12 6 14.01 6 16.5S8.01 21 10.5 21c2.31 0 4.2-1.75 4.45-4H15V6h4V3h-7z"/></svg>',open:'<svg fill="#555" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M10 4H2v16h20V6H12l-2-2z"/></svg>',link:'<svg fill="#555" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"><path d="M19 12v7H5v-7H3v7c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-7h-2zm-6 .67l2.59-2.58L17 11.5l-5 5-5-5 1.41-1.41L11 12.67V3h2z"/><path fill="none" d="M0 0h24v24H0z"/></svg>',close:'<svg stroke="#ff8" xmlns="http://www.w3.org/2000/svg" width="7" height="7" viewBox="0 0 7 7"><line x1="1" y1="1" x2="6" y2="6"/><line x1="1" y1="6" x2="6" y2="1"/></svg>'}};n.prototype.on=function(){this.div.style.backgroundColor=e.btn.backgroundColor.on,this.div.style.borderColor=e.btn.borderColor.on,this.div.firstChild.style.fill=e.btn.svgFill.on},n.prototype.off=function(){this.div.style.backgroundColor=e.btn.backgroundColor.off,this.div.style.borderColor=e.btn.borderColor.off,this.div.firstChild.style.fill=e.btn.svgFill.off},n.prototype.disable=function(){this.div.style.backgroundColor=e.btn.backgroundColor.disable,this.div.style.borderColor=e.btn.borderColor.disable,this.div.firstChild.style.fill=e.btn.svgFill.disable},n.prototype.title=function(t){this.div.title=t};var o=0;r.prototype=new t.Widget,r.prototype.constructor=r,r.prototype.label=function(t){this.lbl.innerHTML=t},r.prototype.disable=function(){this.playBtn.disable(),this.pauseBtn.disable(),this.stopBtn.disable(),this.loopBtn.disable(),this.midiBtn.disable(),this._conn&&this.midiBtn.off(),this.fileBtn.off(),this.rail.style.borderColor=e.rail.borderColor.disable,this.rail.style.backgroundColor=e.rail.backgroundColor.disable,this.caret.style.borderColor=e.caret.borderColor.disable,this.caret.style.backgroundColor=e.caret.backgroundColor.disable},r.prototype.enable=function(){this.playBtn.off(),this.pauseBtn.off(),this.stopBtn.off(),this.loopBtn.off(),this._conn&&this.midiBtn.off(),this.rail.style.borderColor=e.rail.borderColor.enable,this.caret.style.backgroundColor=e.caret.backgroundColor.enable,this.caret.style.borderColor=e.caret.borderColor.enable},r.prototype.load=function(t){var i=this;this._player=t.player(),this._player.trim(),this._player.connect(this),this._player.onEnd=function(){i._onEnd()},this._player.filter(this._setfilter),this._sndoff||(this._player.sndOff=s),this.enable(),this.onLoad(t)},r.prototype.filter=function(t){this._setfilter=t instanceof Function?t:void 0,this._player&&this._player.filter(this._setfilter)},r.prototype.onSelect=s,r.prototype.onEnd=s,r.prototype.onLoad=s,r.prototype._onEnd=function(){this.onEnd(),this._loop&&-1!=this._loop&&this._loop--,this._loop?1==this._loop?(this._loop=0,this.loopBtn.off(),this.loopBtn.title("loop")):this.loopBtn.title("loop: "+(-1==this._loop?"8":this._loop)):(this._moving&&clearInterval(this._moving),this._move(),this._playing=!1,this.playBtn.off())},r.prototype._move=function(){var t=Math.round(this._player.positionMS()*this.rlen/this._player.durationMS())-5;this.caret.style.left=t+"px"},r.prototype.onPlay=s,r.prototype.onResume=s,r.prototype._resume=function(){var t=this;this._player.resume(),this._moving=setInterval((function(){t._move()}),100)},r.prototype.play=function(){if(this._player){var i=this;if(this.playBtn.on(),this.pauseBtn.off(),this._playing)return;this._paused?this.onResume():this.onPlay(),this._playing=!0,this._paused=!1,this._out||!this._conn?this._resume():this._waiting||(this._waiting=!0,t().openMidiOut(i._ports).and((function(){i._out=this,i._outname=this.name(),i.midiBtn.title(i._outname),i._m2m1.connect(this),i._waiting=!1,i.onSelect(i._outname),i._playing&&i._resume()})).or((function(){i._waiting=!1,i._resume()})))}},r.prototype.onStop=s,r.prototype.stop=function(){if(this._player){var i=this;this._player.stop(),t.lib.schedule((function(){i.onStop()})),this._moving&&clearInterval(this._moving),this._playing=!1,this._paused=!1,this.playBtn.off(),this.pauseBtn.off(),this._move()}},r.prototype.onPause=s,r.prototype.pause=function(i){if(this._player){var e=this;this._paused?(void 0===i||i)&&(this._out?(this._resume(),this.onResume(),this._playing=!0,this._paused=!1,this.playBtn.on(),this.pauseBtn.off()):this.play()):this._playing&&(void 0!==i&&i||(this._player.pause(),t.lib.schedule((function(){e.onPause()})),this._moving&&clearInterval(this._moving),this._playing=!1,this._paused=!0,this.playBtn.off(),this.pauseBtn.on()))}},r.prototype.onLoop=s,r.prototype.loop=function(i){if(this._player){var e=this;void 0===i&&(i=!this._loop),i==parseInt(i)&&i>0?this._loop=i:this._loop=i?-1:0,1==this._loop&&(this._loop=0),this._player.loop(this._loop),t.lib.schedule((function(){e.onLoop(i)})),this._loop?(this.loopBtn.on(),this.loopBtn.title("loop: "+(-1==this._loop?"8":this._loop))):(this.loopBtn.off(),this.loopBtn.title("loop"))}},r.prototype.onClose=s,r.prototype.destroy=function(){if(this.stop(),this._out){var i=this._out;t.lib.schedule((function(){i.close()}))}this.gui.parentNode.removeChild(this.gui),this.onClose()},r.prototype.setUrl=function(t,i){this.linkBtn&&(this._url&&(this.linkBtn.div.appendChild(this._url.firstChild),this.linkBtn.div.removeChild(this._url),this._url=void 0),void 0===t?this.linkBtn.disable():(this.linkBtn.off(),this._url=document.createElement("a"),this._url.target="_blank",this._url.appendChild(this.linkBtn.div.firstChild),this.linkBtn.div.appendChild(this._url),this._url.href=t,this._url.dataset||(this._url.dataset={}),this._url.dataset.jzzGuiPlayer=!0,void 0!==i&&(this._url.download=i)))},r.prototype.readFile=function(i){var e=this,o=new FileReader;o.onload=function(o){for(var s,n="",l=new Uint8Array(o.target.result),r=0;r<l.length;r++)n+=String.fromCharCode(l[r]);var a="audio/midi";try{s=new t.MIDI.Clip(n),a="audio/midi-clip"}catch(t){}try{s||(s=new t.MIDI.SYX(n),a="application/octet-stream")}catch(t){}try{s||(s=new t.MIDI.SMF(n)),e.stop(),t.lib.schedule((function(){e.load(s)})),e.linkBtn&&e.setUrl("data:"+a+";base64,"+t.lib.toBase64(n),i.name)}catch(t){console.log(t.message)}},o.readAsArrayBuffer(i)},r.prototype.onSelect=s,r.prototype._closeselect=function(){this.midiBtn.off(),this.sel.style.display="none",this._more=!1},r.prototype.settings=function(){if(!this._more&&this._conn){var i=this;this._more=!0,this.midiBtn.on(),this.sel.style.display="inline-block",t().refresh().and((function(){var t,e=this.info().outputs;for(t=0;t<i.sel.options.length;t++)i.sel.remove(t);for(t=0;t<e.length;t++)i.sel[t]=new Option(e[t].name,e[t].name,e[t].name==i._outname,e[t].name==i._outname);i.sel.size=e.length<2?2:e.length,i.sel.focus()}))}},r.prototype._selectMidi=function(){var i=this;t().openMidiOut(this._newname).or((function(){i._newname=void 0,i._closeselect()})).and((function(){if(i._newname=void 0,i._outname!=this.name()){if(i._outname=this.name(),i._closeselect(),i._out){if(i._playing)for(var e=0;e<16;e++)i._out._receive(t.MIDI.allSoundOff(e));i._m2m1.disconnect(i._out),i._out.close()}i._out=this,i._m2m1.connect(this),i.midiBtn.title(i._outname),i.onSelect(i._outname),setTimeout((function(){i.onSelect(i._outname)}),0)}}))},r.prototype.select=function(t){var i=this;this._newname=t||0,this._newname==this._outname?(this._newname=void 0,this._closeselect()):setTimeout((function(){i._selectMidi()}),0)},r.prototype._selected=function(){var t=this.sel.options[this.sel.selectedIndex];t&&this.select(t.value)},r.prototype._keydown=function(t){13!=t.keyCode&&32!=t.keyCode||this._selected()},r.prototype.type=function(){return this._player?this._player.type():0},r.prototype.tracks=function(){return this._player?this._player.tracks():0},r.prototype.duration=function(){return this._player?this._player.duration():0},r.prototype.durationMS=function(){return this._player?this._player.durationMS():0},r.prototype.position=function(){return this._player?this._player.position():0},r.prototype.positionMS=function(){return this._player?this._player.positionMS():0},r.prototype.tick2ms=function(){return this._player?this._player.tick2ms():0},r.prototype.ms2tick=function(){return this._player?this._player.ms2tick():0},r.prototype.onJump=s,r.prototype.jump=function(t){this._player&&(this._player.jump(t),this._move(),this._playing||(t?(this._paused=!0,this.playBtn.off(),this.pauseBtn.on()):(this._paused=!1,this.playBtn.off(),this.pauseBtn.off())),this.onJump(this._player.position()))},r.prototype.jumpMS=function(t){this._player&&(this._player.jumpMS(t),this._move(),this._playing||(t?(this._paused=!0,this.playBtn.off(),this.pauseBtn.on()):(this._paused=!1,this.playBtn.off(),this.pauseBtn.off())),this.onJump(this._player.position()))},r.prototype.speed=function(t){return this._player?this._player.speed(t):1},r.prototype._mousedown=function(t){a(t)&&this._player&&(this._more||t.preventDefault(),this.caret.style.backgroundColor=e.caret.backgroundColor.mouseDown,this._wasPlaying=this._playing,this._player.pause(),this._caretX=t.clientX,this._caretPos=parseInt(this.caret.style.left)+5)},r.prototype._startmove=function(t){a(t)&&(this._more||t.preventDefault(),this._startX=parseInt(this.gui.style.left),this._startY=parseInt(this.gui.style.top),this._clickX=t.clientX,this._clickY=t.clientY)},r.prototype._mouseup=function(){this._player&&void 0!==this._caretX&&(this._wasPlaying&&(this._wasPlaying=void 0,this._player.resume()),this.caret.style.backgroundColor=e.caret.backgroundColor.mouseUp,this._caretX=void 0),void 0!==this._startX&&(this._startX=void 0,this._startY=void 0,this._clickX=void 0,this._clickY=void 0)},r.prototype._mousemove=function(t){if(this._more&&(this._startX=void 0,this._startY=void 0,this._clickX=void 0,this._clickY=void 0),this._player&&void 0!==this._caretX){t.preventDefault();var i=this._caretPos+t.clientX-this._caretX;i<0&&(i=0),i>this.rlen&&(i=this.rlen),this.jumpMS(this.durationMS()*i*1/this.rlen)}else void 0!==this._startX&&(t.preventDefault(),this.gui.style.left=this._startX-this._clickX+t.clientX+"px",this.gui.style.top=this._startY-this._clickY+t.clientY+"px")},r.prototype._connect=r.prototype.connect,r.prototype._disconnect=r.prototype.disconnect,r.prototype.connect=function(t){t==this?(this._conn=!0,this.midiBtn.off()):this._connect(t)},r.prototype.disconnect=function(t){t==this?(this._conn=!1,this._out&&this._m2m1.disconnect(this._out),this._outname=void 0,this.midiBtn.disable()):(this._disconnect(t),this._connect(this._m2m1))},r.prototype.connected=function(){return this._outname},t.gui.Player=r,t.gui.Player.Btn=n,t.gui.Player.theme=e}function s(){}function n(t){this.div=document.createElement("div"),this.div.style.display="inline-block",this.div.style.position="absolute",this.div.style.boxSizing="content-box",this.div.style.top="8px",this.div.style.margin="0",this.div.style.padding="2px",this.div.style.borderRadius=e.btn.borderRadius,this.div.style.borderStyle="solid",this.div.style.borderWidth=e.container.borderWidth,this.div.style.borderColor=e.btn.borderColor.disable,this.div.style.backgroundColor=e.btn.backgroundColor.disable,this.div.style.lineHeight="0",this.div.style.lineSpasing="0",this.div.style.width="18px",this.div.style.height="18px",this.div.innerHTML=t}function l(t){t.stopPropagation(),t.preventDefault()}function r(s,a){if(!(this instanceof r))return new r(s,a);this._m2m1=new t.M2M1,this._connect(this._m2m1);var p={at:void 0,x:void 0,y:void 0,play:!0,record:!1,pause:!0,stop:!0,loop:!0,file:!1,link:!1,midi:!0,close:!1,sndoff:!0,ports:[void 0,/MIDI Through/i],connect:!0};if("object"==typeof s)for(var d in p)p.hasOwnProperty(d)&&void 0!==s[d]&&(p[d]=s[d]);if(void 0===p.at&&(p.at=s),void 0===p.x&&(p.x=s),void 0===p.y&&(p.y=a),function(t,o){t.gui=document.createElement("div"),t.gui.style.display="inline-block",t.gui.style.position="relative",t.gui.style.boxSizing="content-box",t.gui.style.margin="0px",t.gui.style.padding="0px",t.gui.style.borderRadius=e.container.borderRadius,t.gui.style.borderStyle="none",t.gui.style.backgroundColor=e.container.backgroundColor,t.gui.style.width="270px",t.gui.style.height="40px";var s=8,r=238,a=28;o.play?(t.playBtn=new n(e.svg.play),t.playBtn.div.style.left=s+"px",s+=a,t.playBtn.div.title="play",t.playBtn.div.addEventListener("click",(function(){t.play()})),t.gui.appendChild(t.playBtn.div)):t.playBtn=i,o.pause?(t.pauseBtn=new n(e.svg.pause),t.pauseBtn.div.style.left=s+"px",s+=a,t.pauseBtn.div.title="pause",t.pauseBtn.div.addEventListener("click",(function(){t.pause()})),t.gui.appendChild(t.pauseBtn.div)):t.pauseBtn=i,o.stop?(t.stopBtn=new n(e.svg.stop),t.stopBtn.div.style.left=s+"px",s+=a,t.stopBtn.div.title="stop",t.stopBtn.div.addEventListener("click",(function(){t.stop()})),t.gui.appendChild(t.stopBtn.div)):t.stopBtn=i,o.loop?(t.loopBtn=new n(e.svg.loop),t.loopBtn.div.style.left=s+"px",s+=a,t.loopBtn.div.title="loop",t.loopBtn.div.addEventListener("click",(function(){t.loop()})),t.gui.appendChild(t.loopBtn.div)):t.loopBtn=i,o.midi?(t.midiBtn=new n(e.svg.more),t.midiBtn.div.style.left=r+"px",r-=a,t.midiBtn.div.title="midi",t.midiBtn.div.addEventListener("click",(function(){t.settings()})),t.gui.appendChild(t.midiBtn.div),t.sel=document.createElement("select"),t.sel.style.position="absolute",t.sel.style.top="30px",t.sel.style.left="40px",t.sel.style.width="230px",t.sel.style.display="none",t.sel.style.zIndex=1,t.sel.addEventListener("click",(function(){t._selected()})),t.sel.addEventListener("keydown",(function(i){t._keydown(i)})),t.sel.addEventListener("focusout",(function(){t._closeselect()})),t.gui.appendChild(t.sel)):t.midiBtn=i,o.link&&(t.linkBtn=new n(e.svg.link),t.linkBtn.div.style.left=r+"px",r-=a,t.linkBtn.div.title="link",t.gui.appendChild(t.linkBtn.div)),o.file?(t.fileBtn=new n(e.svg.open),t.fileBtn.div.style.left=r+"px",r-=a,t.fileBtn.div.title="file",t.gui.appendChild(t.fileBtn.div),t.fileInput=document.createElement("input"),t.fileInput.type="file",t.fileInput.style.position="fixed",t.fileInput.style.visibility="hidden",t.fileInput.accept=".mid, .midi, .midi2, .kar, .rmi, .syx",t.gui.appendChild(t.fileInput),window.FileReader&&(t.fileBtn.off(),t.fileBtn.div.addEventListener("click",(function(){t.fileInput.click()})),t.fileInput.addEventListener("change",(function(i){l(i),i.target.files[0]&&t.readFile(i.target.files[0])})),t.gui.addEventListener("drop",(function(i){l(i),t.fileBtn.off(),t.readFile(i.dataTransfer.files[0])})),t.gui.addEventListener("dragover",(function(i){l(i),t.fileBtn.on(),i.dataTransfer.dropEffect="copy"})),t.gui.addEventListener("dragexit",(function(i){l(i),t.fileBtn.off()})))):t.fileBtn=i,o.close&&(t.closeBtn=document.createElement("div"),t.closeBtn.style.display="inline-block",t.closeBtn.style.position="absolute",t.closeBtn.style.boxSizing="content-box",t.closeBtn.style.top="1px",t.closeBtn.style.left="262px",t.closeBtn.style.margin="0",t.closeBtn.style.padding="0",t.closeBtn.style.borderRadius=e.btn.close.borderRadius,t.closeBtn.style.backgroundColor=e.btn.close.backgroundColor,t.closeBtn.style.width="7px",t.closeBtn.style.height="7px",t.closeBtn.style.lineHeight="0",t.closeBtn.style.lineSpasing="0",t.closeBtn.innerHTML=e.svg.close,t.closeBtn.title="close",t.closeBtn.addEventListener("click",(function(){t.destroy()})),t.gui.appendChild(t.closeBtn)),t.rlen=r-s+10,t.lbl=document.createElement("div"),t.lbl.style.display="inline-block",t.lbl.style.position="absolute",t.lbl.style.top="26px",t.lbl.style.left=s+"px",t.lbl.style.width=t.rlen+10+"px",t.lbl.style.height="12px",t.lbl.style.padding="0",t.lbl.style.textAlign="center",t.lbl.style.color=e.lbl.color,t.lbl.style.fontSize=e.lbl.fontSize,t.lbl.style.fontFamily=e.lbl.fontFamily,t.gui.appendChild(t.lbl),t.rail=document.createElement("div"),t.rail.style.display="inline-block",t.rail.style.position="absolute",t.rail.style.boxSizing="content-box",t.rail.style.top="19px",t.rail.style.left=s+5+"px",t.rail.style.width=t.rlen+"px",t.rail.style.height="0",t.rail.style.padding="1px",t.rail.style.borderStyle="solid",t.rail.style.borderWidth=e.rail.borderWidth,t.rail.style.borderRadius=e.rail.borderRadius,t.rail.style.borderColor=e.rail.borderColor.disable,t.rail.style.backgroundColor=e.rail.backgroundColor.disable,t.gui.appendChild(t.rail),t.caret=document.createElement("div"),t.caret.style.display="inline-block",t.caret.style.position="absolute",t.caret.style.boxSizing="content-box",t.caret.style.width="2px",t.caret.style.height="2px",t.caret.style.top="-5px",t.caret.style.left="-5px",t.caret.style.padding="4px",t.caret.style.borderStyle="solid",t.caret.style.borderWidth=e.caret.borderWidth,t.caret.style.borderRadius=e.caret.borderRadius,t.caret.style.borderColor=e.caret.borderColor.disable,t.caret.style.backgroundColor=e.caret.backgroundColor.disable,t.caret.addEventListener("mousedown",(function(i){t._mousedown(i)})),t.rail.appendChild(t.caret),window.addEventListener("mousemove",(function(i){t._mousemove(i)})),window.addEventListener("mouseup",(function(i){t._mouseup(i)}))}(this,p),p.ports instanceof Array||(p.ports=[p.ports]),p.ports.push(void 0),this._ports=p.ports,this._conn=p.connect,this._sndoff=p.sndoff,this.disable(),"string"==typeof p.at)try{return document.getElementById(p.at).appendChild(this.gui),this}catch(t){}try{return p.at.appendChild(this.gui),this}catch(t){}p.x==parseInt(p.x)&&p.y==parseInt(p.y)||(p.x=15*o+5,p.y=45*o+5,o++),this.gui.style.position="fixed",this.gui.style.top=p.y+"px",this.gui.style.left=p.x+"px",this.gui.style.opacity=.9;var h=this;this.gui.addEventListener("mousedown",(function(t){h._startmove(t)})),document.body.appendChild(this.gui)}function a(t){return void 0===t.buttons?!t.button:1&t.buttons}}));
//# sourceMappingURL=/sm/8c867adc376b808a0a3a65ded153f7d9c78f1ae2e88912e993a7da3183805582.map

