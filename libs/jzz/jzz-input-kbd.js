/**
 * Minified by jsDelivr using Terser v5.19.2.
 * Original file: /npm/jzz-input-kbd@1.3.3/javascript/JZZ.input.Kbd.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?(i.Kbd=i,module.exports=i):"function"==typeof define&&define.amd?define("JZZ.input.Kbd",["JZZ"],i):i(JZZ)}(0,(function(t){if(t){t.input||(t.input={});for(var i,e="1.3.3",s={a:10,b:11,c:12,d:13,e:14,f:15,A:10,B:11,C:12,D:13,E:14,F:15},n=0;n<16;n++)s[n]=n;c.prototype.channel=function(t){if(void 0===this.mpe){var i=s[t];void 0!==i&&(this.chan=i)}return this.chan},p.prototype._info=function(t){return{type:"html/javascript",name:r(t,"ASCII"),manufacturer:"virtual",version:e}},p.prototype._openIn=function(i,e){var s=new c(this._arg);s.port=i,s.mpe?(i._orig._mpe||(i._orig._mpe=t.MPE()),i._orig._mpe.setup(s.mpe[0],s.mpe[1]),s.noteOn=function(e){var s=t.MIDI(144+this.chan,e,127);s._mpe=e,i._receive(s)},s.noteOff=function(e){var s=t.MIDI(128+this.chan,e,127);s._mpe=e,i._receive(s)}):(s.noteOn=function(e){i._receive(t.MIDI(144+this.chan,e,127))},s.noteOff=function(e){i._receive(t.MIDI(128+this.chan,e,127))}),i._info=this._info(e),i._close=function(){s._close()},i.channel=function(t){return s.channel(t)},i._resume()},t.input.ASCII=function(){var i,e;1==arguments.length?"string"==typeof arguments[0]?i=arguments[0]:e=arguments[0]:(i=arguments[0],e=arguments[1]);var s=new p;return s._arg=e,t.lib.openMidiIn(i,s)},t.input.ASCII.register=function(){var i,e;1==arguments.length?"string"==typeof arguments[0]?i=arguments[0]:e=arguments[0]:(i=arguments[0],e=arguments[1]);var s=new p;return s._arg=e,t.lib.registerMidiIn(i,s)},E.prototype.channel=function(t){if(void 0===this.mpe){var i=s[t];if(void 0!==i&&i!=this.chan){for(var e in this.playing)y(this.keys[e],this.keys[e]._active?this.stl0[e]:this.stl2[e]),y(this.keys[e],this.locs[e]);this.chan=i}}return this.chan},E.prototype._close=function(){for(var t in this.playing)"M"!=this.playing[t]&&"T"!=this.playing[t]||this.noteOff(t);this.resize&&window.removeEventListener("resize",this.resize),this.cleanup()},E.prototype.press=function(t){this.keys[t]._active&&(y(this.keys[t],this.stl1[t]),y(this.keys[t],this.locs[t]),this.noteOn(t))},E.prototype.release=function(t){this.keys[t]._active&&(y(this.keys[t],this.stl0[t]),y(this.keys[t],this.locs[t]),this.noteOff(t))},E.prototype.forward=function(t){var i=t[1],e=t.getChannel();if(e>=this.chan&&e<=(this.mpe?this.chan+this.mpe[1]:this.chan)){var s=t[0]>>4;if(t.isNoteOn())this.keys[i]&&(this.playing[i]="E",y(this.keys[i],this.stl1[i]),y(this.keys[i],this.locs[i]));else if(t.isNoteOff())this.keys[i]&&(this.playing[i]=void 0,y(this.keys[i],this.keys[i]._active?this.stl0[i]:this.stl2[i]),y(this.keys[i],this.locs[i]));else if(11==s&&(120==i||123==i))for(i in this.playing)this.playing[i]=void 0,y(this.keys[i],this.keys[i]._active?this.stl0[i]:this.stl2[i]),y(this.keys[i],this.locs[i])}this.emit(t)},E.prototype.clear=function(){for(var t in this.playing)this.playing[t]=void 0,y(this.keys[t],this.keys[t]._active?this.stl0[t]:this.stl2[t]),y(this.keys[t],this.locs[t])},E.prototype.findKey=function(t,i,e){for(var s in this.keys)for(var n=document.elementFromPoint(t,i);n;n=n.parentNode)if(this.keys[s]==n)return void(e[s]=!0)},E.prototype.create=function(){for(var t=0,i=0;i<this.bins.length&&this.bins[i]<=window.innerWidth;i++)t=this.bins[i];this.current=this.params[t],this.createCurrent()},E.prototype.createCurrent=function(){if(this.cleanup(),this.keys={},this.locs={},this.stl0={},this.stl1={},this.stl2={},this.playing={},this.touches={},this.current.ul||(this.current.ul=I(this.current.wl,this.current.bl),this.current.wl=parseFloat(this.current.wl),this.current.bl=parseFloat(this.current.bl)),this.current.uw||(this.current.uw=I(this.current.ww,this.current.bw),this.current.ww=parseFloat(this.current.ww),this.current.bw=parseFloat(this.current.bw)),this.current.keys)this.createWithKeys(this.current.keys);else{"string"==typeof this.current.at&&(this.current.at=document.getElementById(this.current.at));try{this.createAt(this.current.at)}catch(t){this.bottom||(this.bottom=document.createElement("div"),document.body.appendChild(this.bottom)),this.createAt(this.bottom)}}},E.prototype.createWithKeys=function(i){for(var e in i){var s=t.MIDI.noteValue(i[e][1]),n=i[e][0];"string"==typeof n&&(n=document.getElementById(n)),this.keys[s]=n,this.locs[s]={},this.stl0[s]={},this.stl1[s]={},this.stl2[s]={}}this.setListeners(),this.current.onCreate&&this.current.onCreate.apply(this)},E.prototype.createAt=function(t){t.innerHTML="";var i=this.current.pos.toUpperCase(),e=m(this.current.from),s=m(this.current.to,!0),n=s-e+1,o=n*this.current.ww,r=this.current.wl,h=this.current.ul,a=this.current.uw,u=this.current.ww,c=this.current.wl,p=this.current.bw,l=this.current.bl;"%"!=a&&(o++,u--,p--),"%"!=h&&(r++,c--,l--);var d,f,v,g="N"!=i^!this.current.rev,w="E"!=i^!this.current.rev,k=document.createElement("span");k.style.display="inline-block",k.style.position="relative",k.style.margin="0px",k.style.padding="0px",k.style.borderStyle="none",k.style.userSelect="none",k.style.MozUserSelect="none",k.style.WebkitUserSelect="none",k.style.MsUserSelect="none",k.style.KhtmlUserSelect="none",k.style.cursor="default","E"==i||"W"==i?(k.style.width=r+h,k.style.height=o+a):(k.style.width=o+a,k.style.height=r+h);for(var x=0;x<n;x++)d=b(x+e),f=document.createElement("span"),this.keys[d]=f,v={display:"inline-block",position:"absolute",margin:"0px",padding:"0px",borderStyle:"solid",borderWidth:"1px"},this.locs[d]=v,"E"==i||"W"==i?(v.width=c+h,v.height=u+a,v.left="0px",v[w?"top":"bottom"]=this.current.ww*x+a):(v.width=u+a,v.height=c+h,v.top="0px",v[g?"left":"right"]=this.current.ww*x+a,v.verticalAlign="top"),this.stl0[d]={backgroundColor:"#fff",borderColor:"#000"},this.stl1[d]={backgroundColor:"#aaa",borderColor:"#000"},this.stl2[d]={backgroundColor:"#fff",borderColor:"#000"},y(f,this.stl0[d]),y(f,v),k.appendChild(f);var E=Math.ceil(this.current.ww-3*this.current.bw/4);(E+this.current.ww)%2&&E--;var I=b(e)+1,_=b(s);for(d=I;d<_;d++){var M,S=d%12,K=Math.floor(d/12);if(1==S)M=Math.floor(this.current.ww*(7*K+1.5-e))-E/2-this.current.bw;else if(3==S)M=Math.floor(this.current.ww*(7*K+1.5-e)+E/2);else if(6==S)M=this.current.ww*(7*K+5-e)-Math.floor(this.current.bw/2)-E-this.current.bw;else if(8==S)M=this.current.ww*(7*K+5-e)-Math.floor(this.current.bw/2);else{if(10!=S)continue;M=this.current.ww*(7*K+5-e)-Math.floor(this.current.bw/2)+E+this.current.bw}f=document.createElement("span"),this.keys[d]=f,v={display:"inline-block",position:"absolute",margin:"0px",padding:"0px",borderStyle:"solid",borderWidth:"1px"},this.locs[d]=v,"E"==i||"W"==i?(v.width=l+h,v.height=p+a,v["E"==i?"right":"left"]="0px",v[w?"top":"bottom"]=M+a):(v.width=p+a,v.height=l+h,v["N"==i?"top":"bottom"]="0px",v[g?"left":"right"]=M+a),this.stl0[d]={backgroundColor:"#000",borderColor:"#000"},this.stl1[d]={backgroundColor:"#888",borderColor:"#000"},this.stl2[d]={backgroundColor:"#000",borderColor:"#000"},y(f,this.stl0[d]),y(f,v),k.appendChild(f)}t.appendChild(k),this.current.at=t,this.at=t,this.setListeners(),this.current.onCreate&&this.current.onCreate.apply(this)},E.prototype.setListeners=function(){var t,e,s=void 0===this.current.active||!!this.current.active;for(t in this.watchButtons=function(t){i=t.buttons},this.mouseUpHandle=(e=this,function(t){f(t=l(t))&&(e.mouseDown=!1)}),window.addEventListener("mousedown",this.watchButtons),window.addEventListener("mousemove",this.watchButtons),window.addEventListener("mouseup",this.mouseUpHandle),this.touchHandle=function(t){return function(i){i.preventDefault();for(var e={},s=0;s<i.touches.length;s++)t.findKey(i.touches[s].clientX,i.touches[s].clientY,e);var n,o={};for(n in e)n in t.touches?o[n]=!0:void 0===t.playing[n]&&(t.playing[n]="T",t.press(n),o[n]=!0);for(n in t.touches)n in e||(t.playing[n]=void 0,t.release(n));t.touches=o}}(this),this.mouseDownH=[],this.mouseOverH=[],this.mouseOutH=[],this.mouseUpH=[],this.keys)this.mouseDownH[t]=g(this,t),this.mouseOverH[t]=w(this,t),this.mouseOutH[t]=k(this,t),this.mouseUpH[t]=x(this,t),this.keys[t].addEventListener("mousedown",this.mouseDownH[t]),this.keys[t].addEventListener("mouseover",this.mouseOverH[t]),this.keys[t].addEventListener("mouseout",this.mouseOutH[t]),this.keys[t].addEventListener("mouseup",this.mouseUpH[t]),this.keys[t].addEventListener("touchstart",this.touchHandle),this.keys[t].addEventListener("touchmove",this.touchHandle),this.keys[t].addEventListener("touchend",this.touchHandle),this.keys[t].addEventListener("touchcancel",this.touchHandle);for(t in this.keys)void 0===this.keys[t]._active&&(this.keys[t]._active=s),this.keys[t].ondragstart=v,this.keys[t].onselectstart=v;if(!this.resize&&this.bins.length>1){var n=this;this.resize=function(){n.onResize()},window.addEventListener("resize",this.resize)}},E.prototype.cleanup=function(){for(var t in this.watchButtons&&(window.removeEventListener("mousedown",this.watchButtons),window.removeEventListener("mousemove",this.watchButtons),window.removeEventListener("mouseup",this.mouseUpHandle)),this.keys)this.mouseDownH[t]&&this.keys[t].removeEventListener("mousedown",this.mouseDownH[t]),this.mouseOverH[t]&&this.keys[t].removeEventListener("mouseover",this.mouseOverH[t]),this.mouseOutH[t]&&this.keys[t].removeEventListener("mouseout",this.mouseOutH[t]),this.mouseUpH[t]&&this.keys[t].removeEventListener("mouseup",this.mouseUpH[t]),this.touchHandle&&(this.keys[t].removeEventListener("touchstart",this.touchHandle),this.keys[t].removeEventListener("touchmove",this.touchHandle),this.keys[t].removeEventListener("touchend",this.touchHandle),this.keys[t].removeEventListener("touchcancel",this.touchHandle));this.at&&(this.at.innerHTML="")},E.prototype.settings=function(){return h(this.current)},E.prototype.onResize=function(){for(var t=0,i=0;i<this.bins.length&&this.bins[i]<=window.innerWidth;i++)t=this.bins[i];this.current!=this.params[t]&&(this.current=this.params[t],this.createCurrent())},E.prototype.enable=function(){for(var t in this.keys)this.keys[t]._active=!0;return this},E.prototype.disable=function(){for(var t in this.keys)this.keys[t]._active=!1;return this},E.prototype.getKey=function(i){var e=new _(this),s=t.MIDI.noteValue(i);return void 0!==this.keys[s]&&e.keys.push(s),e},E.prototype.getKeys=function(i,e){var s=new _(this),n=void 0===i?void 0:t.MIDI.noteValue(i),o=void 0===e?void 0:t.MIDI.noteValue(e);if(void 0!==n&&void 0!==o&&o<n){var r=n;n=o,o=r}for(var h in this.keys)void 0!==n&&h<n||void 0!==o&&h>o||s.keys.push(h);return s},E.prototype.getWhiteKeys=function(i,e){var s=new _(this),n=void 0===i?void 0:t.MIDI.noteValue(i),o=void 0===e?void 0:t.MIDI.noteValue(e);if(void 0!==n&&void 0!==o&&o<n){var r=n;n=o,o=r}for(var h in this.keys)if(!(void 0!==n&&h<n||void 0!==o&&h>o)){var a=h%12;1!=a&&3!=a&&6!=a&&8!=a&&10!=a&&s.keys.push(h)}return s},E.prototype.getBlackKeys=function(i,e){var s=new _(this),n=void 0===i?void 0:t.MIDI.noteValue(i),o=void 0===e?void 0:t.MIDI.noteValue(e);if(void 0!==n&&void 0!==o&&o<n){var r=n;n=o,o=r}for(var h in this.keys)if(!(void 0!==n&&h<n||void 0!==o&&h>o)){var a=h%12;1!=a&&3!=a&&6!=a&&8!=a&&10!=a||s.keys.push(h)}return s},_.prototype.setInnerHTML=function(t){for(var i in this.keys)this.piano.keys[this.keys[i]].innerHTML=t;return this},_.prototype.setStyle=function(t,i,e){var s,n,o;for(s in void 0===i&&(i=t),void 0===e&&(e=t),this.keys){for(n in o=this.keys[s],t)this.piano.stl0[o][n]=t[n];for(n in i)this.piano.stl1[o][n]=i[n];for(n in e)this.piano.stl2[o][n]=e[n];y(this.piano.keys[o],this.piano.playing[o]?this.piano.stl1[o]:this.piano.keys[o]._active?this.piano.stl0[o]:this.piano.stl2[o]),y(this.piano.keys[o],this.piano.locs[o])}return this},_.prototype.enable=function(){var t,i;for(t in this.keys)i=this.keys[t],this.piano.keys[i]._active=!0,y(this.piano.keys[i],this.piano.playing[i]?this.piano.stl1[i]:this.piano.stl0[i]),y(this.piano.keys[i],this.piano.locs[i]);return this},_.prototype.disable=function(){var t,i;for(t in this.keys)i=this.keys[t],this.piano.keys[i]._active=!1,y(this.piano.keys[i],this.piano.playing[i]?this.piano.stl1[i]:this.piano.stl2[i]),y(this.piano.keys[i],this.piano.locs[i]);return this},M.prototype._info=function(t){return{type:"html/javascript",name:r(t,"Kbd"),manufacturer:"virtual",version:e}},M.prototype._openIn=function(i,e){var s=new E(this._arg);s.send=function(){i.send.apply(i,arguments)},s.connect=function(){i.connect.apply(i,arguments)},s.create(),s.mpe?(i._orig._mpe||(i._orig._mpe=t.MPE()),i._orig._mpe.setup(s.mpe[0],s.mpe[1]),s.noteOn=function(e){var s=t.MIDI(144+this.chan,e,127);s._mpe=e,i._emit(i._filter(s))},s.noteOff=function(e){var s=t.MIDI(128+this.chan,e,127);s._mpe=e,i._emit(i._filter(s))}):(s.noteOn=function(e){i._emit(t.MIDI(144+this.chan,e,127))},s.noteOff=function(e){i._emit(t.MIDI(128+this.chan,e,127))}),s.emit=function(t){i._emit(i._filter(t))},i._info=this._info(e),i._receive=function(t){s.forward(t)},i._close=function(){s._close()},i.settings=function(){return s.settings()},i.getKey=function(t){return s.getKey(t)},i.getKeys=function(t,i){return s.getKeys(t,i)},i.getWhiteKeys=function(t,i){return s.getWhiteKeys(t,i)},i.getBlackKeys=function(t,i){return s.getBlackKeys(t,i)},i.channel=function(t){return s.channel(t)},i.clear=function(){return s.clear()},i._resume()},t.input.Kbd=function(){var i,e;1==arguments.length?"string"==typeof arguments[0]?i=arguments[0]:e=arguments[0]:(i=arguments[0],e=arguments[1]);var s=new M;return s._arg=e,t.lib.openMidiIn(i,s)},t.input.Kbd.version=function(){return e},t.input.Kbd.register=function(){var i,e;1==arguments.length?"string"==typeof arguments[0]?i=arguments[0]:e=arguments[0]:(i=arguments[0],e=arguments[1]);var s=new M;return s._arg=e,t.lib.registerMidiIn(i,s)};var o={margin:0,padding:0,width:"100%",height:"100%"};S.prototype.setBase=function(t){t=parseFloat(t),!isNaN(t)&&isFinite(t)&&t>=0&&t<=1&&(this.base=t)},S.prototype.setValue=function(t){if(t=parseFloat(t),!(isNaN(t)||!isFinite(t)||t<0||t>1||t==this.val))return this.val=t,this.num=Math.round(t*(this.lsb||!this.msb?16383:127)),!0},S.prototype.emit=function(t){this.msb?this.lsb?(t.emit([176+this.chan,this.msb,this.num>>7]),t.emit([176+this.chan,this.lsb,127&this.num])):t.emit([176+this.chan,this.msb,this.num]):t.emit([224+this.chan,127&this.num,this.num>>7])},S.prototype.read=function(t){if(!this.msb&&t[0]==224+this.chan&&t[1]==parseInt(t[1])&&t[2]==parseInt(t[2]))return this.num=t[2]<<7|127&t[1],this.val=this.num/16383,!0;if(this.msb&&t[0]==176+this.chan&&t[2]==parseInt(t[2])){if(t[1]==this.msb)return this.lsb?(this.num=t[2]<<7|127&this.num,this.val=this.num/16383):(this.num=127&t[2],this.val=this.num/127),!0;if(t[1]==this.lsb)return this.num=16256&this.num|127&t[2],this.val=this.num/16383,!0}},K.prototype.setInnerHTML=function(t){return this.inner.innerHTML=t,this},K.prototype.setStyle=function(t,i){var e;for(e in void 0===i&&(i=t),t)this.stl0[e]=t[e];for(e in i)this.stl1[e]=i[e];return y(this.span,this.ctrl.isSelected()?this.stl1:this.stl0),y(this.span,this.stl),this},C.prototype._close=function(){this.at&&(this.at.innerHTML=""),this.mouseUpHandler&&window.removeEventListener("mouseup",this.mouseUpHandler)},C.prototype.create=function(){for(var t=0,i=0;i<this.bins.length&&this.bins[i]<=window.innerWidth;i++)t=this.bins[i];this.current=this.params[t],this.createCurrent()},C.prototype.createCurrent=function(){this.at&&(this.at.innerHTML=""),"string"==typeof this.current.at&&(this.current.at=document.getElementById(this.current.at));try{this.createAt(this.current.at)}catch(t){this.bottom||(this.bottom=document.createElement("div"),document.body.appendChild(this.bottom)),this.createAt(this.bottom)}},C.prototype.onResize=function(){for(var t=0,i=0;i<this.bins.length&&this.bins[i]<=window.innerWidth;i++)t=this.bins[i];this.current!=this.params[t]&&(this.current=this.params[t],this.createCurrent())},C.prototype.settings=function(){return h(this.current)},C.prototype.isSelected=function(){return void 0!==this.dragX},C.prototype.restyle=function(){for(var t in this.spans)this.spans[t].setStyle()},C.prototype.onMouseDown=function(t){var e;void 0===this.dragX&&(this.dragX=t.clientX,this.dragY=t.clientY,this.mouseMove=(e=this,function(t){i=t.buttons,e.onMouseMove(t)}),this.mouseUp=function(t){return function(i){f(i=l(i))&&(window.removeEventListener("mousemove",t.mouseMove),window.removeEventListener("mouseup",t.mouseUp),t.dragX=void 0,t.restyle(),t.onMouseUp(i))}}(this),window.addEventListener("mousemove",this.mouseMove),window.addEventListener("mouseup",this.mouseUp),this.restyle())},C.prototype.onMouseMove=function(t){void 0!==this.dragX&&this.onMove(t.clientX,t.clientY)},C.prototype.onMouseUp=function(){},C.prototype.onTouchStart=function(t){t.preventDefault(),void 0===this.dragX&&(this.touch=t.targetTouches[0].identifier,this.dragX=t.targetTouches[0].clientX,this.dragY=t.targetTouches[0].clientY,this.restyle())},C.prototype.onTouchMove=function(t){if(t.preventDefault(),void 0!==this.dragX&&void 0!==this.touch)for(var i in t.targetTouches)if(t.targetTouches[0].identifier==this.touch)return void this.onMove(t.targetTouches[i].clientX,t.targetTouches[i].clientY)},C.prototype.onTouchEnd=function(t){t.preventDefault(),this.touch=void 0,this.dragX=void 0,this.restyle(),this.onMouseUp(t)},V.prototype=new C,V.prototype.channel=function(t){var i=s[t];return void 0!==i&&i!=this.chan&&(this.chan=i,this.data.chan=i,this.setValue(this.data.base)),this.chan},V.prototype.createAt=function(t){t.innerHTML="";var i=parseInt(this.current.bh),e=parseInt(this.current.bw),s=parseInt(this.current.rh);s||(s=128),this.rh=s;var n=parseInt(this.current.rw);n||(n=2);var r=parseInt(this.current.kh);r||(r=24);var h=parseInt(this.current.kw);h||(h=16);var a=this.current.pos.toUpperCase();this.pos=a,this.data||(this.data=new S(this.current.data),this.data.chan=this.chan,this.data.setBase(this.current.base),this.data.setValue(this.current.val)),this.dx=-h/2,this.dy=-(r/2+1),i||(i=r+s+2),e||(e=(h>n?h:n)+2),this.stlB={display:"inline-block",position:"relative",margin:"0",padding:"0",userSelect:"none",KhtmlUserSelect:"none",MozUserSelect:"none",MsUserSelect:"none",OUserSelect:"none",WebkitUserSelect:"none",cursor:"default"},this.stlB0={borderStyle:"none"},this.stlB1={borderStyle:"none"},this.stlR={display:"inline-block",position:"absolute",margin:"0",padding:"0",borderStyle:"solid",borderWidth:"1px"},this.stlR0={backgroundColor:"#aaa"},this.stlR1={backgroundColor:"#bbb"},this.stlK={display:"inline-block",position:"absolute",margin:"0",padding:"0",borderStyle:"solid",borderWidth:"1px"},this.stlK0={backgroundColor:"#ddd"},this.stlK1={backgroundColor:"#eee"},"E"==a||"W"==a?(this.stlB.width=i+"px",this.stlB.height=e+"px",this.stlR.width=s+"px",this.stlR.height=n+"px",this.stlR.left=(i-s)/2-1+"px",this.stlR.top=(e-n)/2-1+"px",this.stlK.width=r+"px",this.stlK.height=h+"px",this.stlK.top=this.dx+"px"):(this.stlB.width=e+"px",this.stlB.height=i+"px",this.stlR.width=n+"px",this.stlR.height=s+"px",this.stlR.top=(i-s)/2-1+"px",this.stlR.left=(e-n)/2-1+"px",this.stlK.width=h+"px",this.stlK.height=r+"px",this.stlK.left=this.dx+"px");var u=document.createElement("span");this.box=u;var c=document.createElement("span");y(c,o),this.boxSpan=new K(this,u,c,this.stlB,this.stlB0,this.stlB1);var p=document.createElement("span");this.range=p;var l=document.createElement("span");y(l,o),this.rangeSpan=new K(this,p,l,this.stlR,this.stlR0,this.stlR1);var d=document.createElement("span");if(this.knob=d,this.knobSpan=new K(this,d,d,this.stlK,this.stlK0,this.stlK1),this.spans=[this.boxSpan,this.rangeSpan,this.knobSpan],(void 0===this.current.active||this.current.active)&&(u.addEventListener("touchstart",H),d.addEventListener("mousedown",B(this)),d.addEventListener("touchstart",X(this)),d.addEventListener("touchmove",R(this)),d.addEventListener("touchend",D(this)),d.addEventListener("touchcancel",D(this))),this.current.onCreate&&this.current.onCreate.apply(this),p.appendChild(l),p.appendChild(d),u.appendChild(c),u.appendChild(p),u.ondragstart=v,u.onselectstart=v,t.appendChild(u),!this.at&&this.bins.length>1){var f=this;this.resize=function(){f.onResize()},window.addEventListener("resize",this.resize)}this.current.at=t,this.at=t,this.setValue(),y(this.box,void 0===this.dragX?this.stlB0:this.stlB1),y(this.box,this.stlB),y(this.range,void 0===this.dragX?this.stlR0:this.stlR1),y(this.range,this.stlR),y(this.knob,void 0===this.dragX?this.stlK0:this.stlK1),y(this.knob,this.stlK)},V.prototype.getBox=function(){return this.boxSpan},V.prototype.getRange=function(){return this.rangeSpan},V.prototype.getKnob=function(){return this.knobSpan},V.prototype.setValue=function(t){if(void 0===t)t=this.data.val;else if(!this.data.setValue(t))return;t=this.data.val,"N"!=this.pos&&"W"!=this.pos||(t=1-t),t*=this.rh,this.coord=t,t+=this.dy,"N"==this.pos||"S"==this.pos?(this.stlK.top=t+"px",this.knob.style.top=t+"px"):(this.stlK.left=t+"px",this.knob.style.left=t+"px")},V.prototype.onMove=function(t,i){var e;(e="N"==this.pos||"S"==this.pos?this.coord+i-this.dragY:this.coord+t-this.dragX)<0&&(e=0),e>this.rh&&(e=this.rh),this.move(e)},V.prototype.move=function(t){if(this.coord!=t){"N"==this.pos||"S"==this.pos?(this.knob.style.top=t+this.dy+"px",this.stlK.top=this.knob.style.top,this.dragY+=t-this.coord):(this.knob.style.left=t+this.dy+"px",this.stlK.left=this.knob.style.left,this.dragX+=t-this.coord);var i=t/this.rh;"N"!=this.pos&&"W"!=this.pos||(i=1-i),this.data.setValue(i)&&this.data.emit(this),this.coord=t}},V.prototype.forward=function(t){this.emit(t),this.data.read(t)&&this.setValue()},Y.prototype=new C,Y.prototype.channel=function(t){var i=s[t];return void 0!==i&&i!=this.chan&&(this.chan=i,this.dataX.chan=i,this.dataY.chan=i,this.setValue(this.dataX.base,this.dataY.base)),this.chan},Y.prototype.createAt=function(t){t.innerHTML="";var i=parseInt(this.current.bh),e=parseInt(this.current.bw),s=parseInt(this.current.rh);s||(s=128),this.rh=s;var n=parseInt(this.current.rw);n||(n=128),this.rw=n;var r=parseInt(this.current.kh);r||(r=24);var h=parseInt(this.current.kw);h||(h=16);var a=this.current.pos.toUpperCase();this.pos=a,this.dataX||(this.dataX=new S(this.current.dataX),this.dataY=new S(this.current.dataY),void 0!==this.current.dataX||void 0===this.current.dataY||this.dataY.msb||(this.dataX=new S("mod")),void 0!==this.current.dataY||this.dataX.msb||(this.dataY=new S("mod")),this.dataX.chan=this.chan,this.dataY.chan=this.chan,this.dataX.setBase(this.current.baseX),this.dataY.setBase(this.current.baseY),this.dataX.setValue(this.current.valX),this.dataY.setValue(this.current.valY)),this.dx=-(h/2+1),this.dy=-(r/2+1),i||(i=r+s+2),e||(e=h+n+2),this.stlB={display:"inline-block",position:"relative",margin:"0",padding:"0",userSelect:"none",KhtmlUserSelect:"none",MozUserSelect:"none",MsUserSelect:"none",OUserSelect:"none",WebkitUserSelect:"none",cursor:"default"},this.stlB0={borderStyle:"none"},this.stlB1={borderStyle:"none"},this.stlR={display:"inline-block",position:"absolute",margin:"0",padding:"0",borderStyle:"solid",borderWidth:"1px"},this.stlR0={backgroundColor:"#aaa"},this.stlR1={backgroundColor:"#bbb"},this.stlK={display:"inline-block",position:"absolute",margin:"0",padding:"0",borderStyle:"solid",borderWidth:"1px"},this.stlK0={backgroundColor:"#ddd"},this.stlK1={backgroundColor:"#eee"},"E"==a||"W"==a?(this.stlB.width=i+"px",this.stlB.height=e+"px",this.stlR.width=s+"px",this.stlR.height=n+"px",this.stlR.left=(i-s)/2-1+"px",this.stlR.top=(e-n)/2-1+"px",this.stlK.width=r+"px",this.stlK.height=h+"px",this.stlK.top=this.dx+"px"):(this.stlB.width=e+"px",this.stlB.height=i+"px",this.stlR.width=n+"px",this.stlR.height=s+"px",this.stlR.top=(i-s)/2-1+"px",this.stlR.left=(e-n)/2-1+"px",this.stlK.width=h+"px",this.stlK.height=r+"px",this.stlK.left=this.dx+"px");var u=document.createElement("span");this.box=u;var c=document.createElement("span");y(c,o),this.boxSpan=new K(this,u,c,this.stlB,this.stlB0,this.stlB1);var p=document.createElement("span");this.range=p;var l=document.createElement("span");y(l,o),this.rangeSpan=new K(this,p,l,this.stlR,this.stlR0,this.stlR1);var d=document.createElement("span");if(this.knob=d,this.knobSpan=new K(this,d,d,this.stlK,this.stlK0,this.stlK1),this.spans=[this.boxSpan,this.rangeSpan,this.knobSpan],(void 0===this.current.active||this.current.active)&&(u.addEventListener("touchstart",H),d.addEventListener("mousedown",B(this)),d.addEventListener("touchstart",X(this)),d.addEventListener("touchmove",R(this)),d.addEventListener("touchend",D(this)),d.addEventListener("touchcancel",D(this))),this.current.onCreate&&this.current.onCreate.apply(this),p.appendChild(l),p.appendChild(d),u.appendChild(c),u.appendChild(p),u.ondragstart=v,u.onselectstart=v,t.appendChild(u),!this.at&&this.bins.length>1){var f=this;this.resize=function(){f.onResize()},window.addEventListener("resize",this.resize)}this.current.at=t,this.at=t,this.setValue(),y(this.box,void 0===this.dragX?this.stlB0:this.stlB1),y(this.box,this.stlB),y(this.range,void 0===this.dragX?this.stlR0:this.stlR1),y(this.range,this.stlR),y(this.knob,void 0===this.dragX?this.stlK0:this.stlK1),y(this.knob,this.stlK)},Y.prototype.getBox=function(){return this.boxSpan},Y.prototype.getRange=function(){return this.rangeSpan},Y.prototype.getKnob=function(){return this.knobSpan},Y.prototype.setValue=function(t,i){if(void 0===t)t=this.dataX.val,i=this.dataY.val;else if(!this.dataX.setValue(t)&&!this.dataY.setValue(i))return;t=this.dataX.val,i=this.dataY.val,"N"!=this.pos&&"W"!=this.pos||(i=1-i),"S"!=this.pos&&"W"!=this.pos||(t=1-t),t*=this.rw,i*=this.rh,"N"==this.pos||"S"==this.pos?(this.coordX=t,this.coordY=i):(this.coordX=i,this.coordY=t),t+=this.dx,i+=this.dy,"N"==this.pos||"S"==this.pos?(this.stlK.left=t+"px",this.stlK.top=i+"px"):(this.stlK.top=t+"px",this.stlK.left=i+"px"),this.knob.style.left=this.stlK.left,this.knob.style.top=this.stlK.top},Y.prototype.onMove=function(t,i){(t=this.coordX+t-this.dragX)<0&&(t=0),(i=this.coordY+i-this.dragY)<0&&(i=0),"N"==this.pos||"S"==this.pos?(t>this.rw&&(t=this.rw),i>this.rh&&(i=this.rh),this.knob.style.left=t+this.dx+"px",this.knob.style.top=i+this.dy+"px"):(t>this.rh&&(t=this.rh),i>this.rw&&(i=this.rw),this.knob.style.left=t+this.dy+"px",this.knob.style.top=i+this.dx+"px"),this.stlK.left=this.knob.style.left,this.stlK.top=this.knob.style.top,this.dragX+=t-this.coordX,this.dragY+=i-this.coordY,this.coordX=t,this.coordY=i,"E"!=this.pos&&"W"!=this.pos||(t=this.coordY,i=this.coordX),t/=this.rw,i/=this.rh,"N"!=this.pos&&"W"!=this.pos||(i=1-i),"S"!=this.pos&&"W"!=this.pos||(t=1-t),this.dataX.setValue(t)&&this.dataX.emit(this),this.dataY.setValue(i)&&this.dataY.emit(this)},Y.prototype.forward=function(t){this.emit(t),(this.dataX.read(t)||this.dataY.read(t))&&this.setValue()},U.prototype._info=function(t){return{type:"html/javascript",name:r(t,"Slider"),manufacturer:"virtual",version:e}},U.prototype._openIn=function(t,i){var e=new V(this._arg);e.connect=function(){t.connect.apply(t,arguments)},e.send=function(){t.send.apply(t,arguments)},e.create(),e.emit=function(i){t._emit(i)},t._info=this._info(i),t._receive=function(t){e.forward(t)},t._close=function(){e._close()},t.settings=function(){return e.settings()},t.getBox=function(){return e.boxSpan},t.getRange=function(){return e.rangeSpan},t.getKnob=function(){return e.knobSpan},t.setValue=function(t){e.setValue(t)},t.channel=function(t){return e.channel(t)},t._resume()},t.input.Slider=function(){var i,e;1==arguments.length?"string"==typeof arguments[0]?i=arguments[0]:e=arguments[0]:(i=arguments[0],e=arguments[1]);var s=new U;return s._arg=e,t.lib.openMidiIn(i,s)},t.input.Slider.register=function(){var i,e;1==arguments.length?"string"==typeof arguments[0]?i=arguments[0]:e=arguments[0]:(i=arguments[0],e=arguments[1]);var s=new U;return s._arg=e,t.lib.registerMidiIn(i,s)},W.prototype._info=function(t){return{type:"html/javascript",name:r(t,"Pad"),manufacturer:"virtual",version:e}},W.prototype._openIn=function(t,i){var e=new Y(this._arg);e.connect=function(){t.connect.apply(t,arguments)},e.send=function(){t.send.apply(t,arguments)},e.create(),e.emit=function(i){t._emit(i)},t._info=this._info(i),t._receive=function(t){e.forward(t)},t._close=function(){e._close()},t.settings=function(){return e.settings()},t.getBox=function(){return e.boxSpan},t.getRange=function(){return e.rangeSpan},t.getKnob=function(){return e.knobSpan},t.setValue=function(t){e.setValue(t)},t.channel=function(t){return e.channel(t)},t._resume()},t.input.Pad=function(){var i,e;1==arguments.length?"string"==typeof arguments[0]?i=arguments[0]:e=arguments[0]:(i=arguments[0],e=arguments[1]);var s=new W;return s._arg=e,t.lib.openMidiIn(i,s)},t.input.Pad.register=function(){var i,e;1==arguments.length?"string"==typeof arguments[0]?i=arguments[0]:e=arguments[0]:(i=arguments[0],e=arguments[1]);var s=new W;return s._arg=e,t.lib.registerMidiIn(i,s)}}function r(t,i){return t||i}function h(t){var i={};for(var e in t)i[e]=t[e];return i}function a(t){var i=t.toUpperCase();if(1==i.length){var e=i.charCodeAt(0);if(e>=65&&e<=90)return"Key"+i;if(e>=48&&e<=57)return"Digit"+i}return(i={ESC:"Escape",TAB:"Tab",BSP:"Backspace","-":"Minus",_:"Minus","+":"Equal","=":"Equal","[":"BracketLeft","{":"BracketLeft","]":"BracketRight","}":"BracketRight",";":"Semicolon",":":"Semicolon","'":"Quote",'"':"Quote","`":"Backquote","~":"Backquote","|":"Backslash","\\":"Backslash",",":"Comma","<":"Comma",".":"Period",">":"Period","/":"Slash","?":"Slash"," ":"Space"}[i])||t}function u(t){return t>=65&&t<=90?"Key"+String.fromCharCode(t):t>=48&&t<=57?"Digit"+String.fromCharCode(t):{9:"Tab",8:"Backspace",27:"Escape",32:"Space",59:"Semicolon",171:"Equal",173:"Minus",188:"Comma",190:"Period",191:"Slash",192:"Backquote",219:"BracketLeft",220:"Backslash",221:"BracketRight",222:"Quote"}[t]}function c(i){for(var e in this.notes={},this.playing=[],void 0===i&&(i={}),void 0!==i.mpe?(t.MPE.validate(i.mpe),this.mpe=i.mpe,this.chan=i.mpe[0]):(this.chan=s[i.chan],void 0===this.chan&&(this.chan=0)),i){var n=a(e);if("function"==typeof i[e])this.notes[n]=i[e];else{var o=t.MIDI.noteValue(i[e]);void 0!==n&&void 0!==o&&(this.notes[n]=o)}}var r=this;this.keydown=function(t){var i=t.code?r.notes[t.code]:r.notes[u(t.keyCode)];void 0!==i&&(t.preventDefault(),"function"==typeof i?i.apply(r,[!0]):r.playing[i]||(r.playing[i]=!0,r.noteOn(i)))},this.keyup=function(t){var i=t.code?r.notes[t.code]:r.notes[u(t.keyCode)];void 0!==i&&(t.preventDefault(),"function"==typeof i&&i.apply(r,[!1]),r.playing[i]&&(r.playing[i]=void 0,r.noteOff(i)))},"string"==typeof i.at&&(this.at=document.getElementById(i.at));try{this.at.addEventListener("keydown",this.keydown),this.at.addEventListener("keyup",this.keyup),(!this.at.tabIndex||this.at.tabIndex<0)&&(this.at.tabIndex=0)}catch(t){document.addEventListener("keydown",this.keydown),document.addEventListener("keyup",this.keyup),this.at=document}this._close=function(){for(var t in this.at.removeEventListener("keydown",this.keydown),this.at.removeEventListener("keyup",this.keyup),r.playing)r.noteOff(t)}}function p(){}function l(t){return void 0===t.buttons||t.buttons!=i?t:(t.stopPropagation(),0==t.button?{buttons:1^i}:1==t.button?{buttons:4^i}:2==t.button?{buttons:2^i}:void 0)}function d(t){return void 0===t.buttons?!t.button:1&t.buttons}function f(t){return void 0===t.buttons?!t.button:!(1&t.buttons)}function v(){return!1}function y(t,i){if(t)for(var e in i)t.style[e]=i[e]}function m(i,e){return(e?[0,1,1,2,2,3,4,4,5,5,6,6]:[0,0,1,1,2,3,3,4,4,5,5,6])[(i=t.MIDI.noteValue(i))%12]+7*Math.floor(i/12)}function b(t){return 12*Math.floor(t/7)+{0:0,1:2,2:4,3:5,4:7,5:9,6:11}[t%7]}function g(t,e){return function(s){d(s)&&!t.playing[e]&&(t.mouseDown=!0,t.playing[e]="M",t.press(e)),i=s.buttons}}function w(t,e){return function(s){t.mouseDown&&!t.playing[e]&&(t.playing[e]="M",t.press(e)),i=s.buttons}}function k(t,e){return function(s){t.mouseDown&&"M"==t.playing[e]&&!function(t,i){for(;t;t=t.parentNode)if(t==i)return!0;return!1}(s.relatedTarget,this)&&(t.playing[e]=void 0,t.release(e)),i=s.buttons}}function x(t,i){return function(e){f(e=l(e))&&t.mouseDown&&"M"==t.playing[i]&&(t.playing[i]=void 0,t.release(i),t.mouseDown=!1)}}function E(i){this.bins=[],this.params={0:{}};var e,n={from:"C4",to:"E6",ww:42,bw:24,wl:150,bl:100,pos:"N"};for(e in void 0===i&&(i={}),void 0!==i.mpe?(t.MPE.validate(i.mpe),this.mpe=i.mpe,this.chan=i.mpe[0]):(this.chan=s[i.chan],void 0===this.chan&&(this.chan=0)),i)if(e==parseInt(e))this.params[e]=h(i[e]);else{if("chan"==e)continue;if(("from"==e||"to"==e)&&void 0===t.MIDI.noteValue(i[e]))continue;n[e]=i[e]}for(e in this.params){for(var o in this.bins.push(e),n)"from"!=o&&"to"!=o||void 0!==this.params[e][o]&&void 0!==t.MIDI.noteValue(this.params[e][o])||(this.params[e][o]=n[o]),o in this.params[e]||(this.params[e][o]=n[o]);var r=this.params[e].from,a=this.params[e].to;t.MIDI.noteValue(r)>t.MIDI.noteValue(a)&&(this.params[e].from=a,this.params[e].to=r)}this.bins.sort((function(t,i){return t-i}))}function I(t,i){return t=(t+"").trim(),i=(i+"").trim(),t.endsWith("%")&&i.endsWith("%")?"%":"px"}function _(t){this.piano=t,this.keys=[]}function M(){}function S(t){if(this.base=.5,this.val=.5,this.msb=0,this.lsb=0,this.chan=0,t instanceof Array){if(1!=t.length&&2!=t.length)return;if(2==t.length){if(t[1]!=parseInt(t[1])||t[1]<1||t[1]>127)return;this.msb=t[0],t[1]!=t[0]&&(this.lsb=t[1])}else this.msb=t[0]}else if(t==parseInt(t)){if(t<1||t>127)return;this.msb=t}else{var i={mod:[1,33],breath:[2,34],foot:[4,36],portamento:[5,37],volume:[7,39],balance:[8,40],pan:[10,42],expression:[11,43],effect1:[12,44],effect2:[13,45]}[t];i&&(this.msb=i[0],this.lsb=i[1])}this.msb&&7!=this.msb&&8!=this.msb&&10!=this.msb&&(this.base=0),this.val=-1,this.setValue(this.base)}function K(t,i,e,s,n,o){this.ctrl=t,this.span=i,this.inner=e,this.stl=s,this.stl0=n,this.stl1=o}function C(){}function L(t,i){var e;for(e in this.bins=[],this.params={0:{}},void 0===t&&(t={}),void 0===i&&(i={}),this.chan=s[t.chan],void 0===this.chan&&(this.chan=0),t)if(e==parseInt(e))this.params[e]=h(t[e]);else{if("chan"==e)continue;i[e]=t[e]}for(e in this.params)for(var n in this.bins.push(e),i)"from"!=n&&"to"!=n||void 0!==m(this.params[e][n])||(this.params[e][n]=i[n]),n in this.params[e]||(this.params[e][n]=i[n]);this.bins.sort((function(t,i){return t-i}))}function B(t){return function(e){i=e.buttons,d(e)&&t.onMouseDown(e)}}function X(t){return function(i){t.onTouchStart(i)}}function R(t){return function(i){t.onTouchMove(i)}}function D(t){return function(i){t.onTouchEnd(i)}}function H(t){t.preventDefault()}function V(t){L.call(this,t,{pos:"N",rw:2,rh:128,kw:24,kh:16})}function Y(t){L.call(this,t,{pos:"N",rw:128,rh:128,kw:24,kh:16})}function U(){}function W(){}}));
//# sourceMappingURL=/sm/385bdad92a8c4d76fdde920338b9fd60a59dc3450af0574d9c900a510e70c2c6.map

